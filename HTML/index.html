<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>HTTP Admin</title>
		<link rel="stylesheet" type="text/css" href="css/main.css">

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<script src="js/dedi.js"></script>
		<script src="js/hub.js"></script>
	
<script>
var serverType = "";

$( document ).ready(function() {
    console.log( "ready!" );
	
	// Get the server type
	getServerType();
	
	if (serverType != "" && serverType != "unknown")
	{
		// Load the summary page
		loadPage("summary.html");
		
		// Load the menu
		loadMenu();
	} else {
		$("#nav").html("");
		$("#content").html("Error: Unkown server type");
	}
});

/*
Gets the current server type
*/
function getServerType()
{
	// TODO set a cookie which caches serverType, only request from server after a hour
	$.ajax({
		url: "request.json",
		type: "GET",
		cache: false,
		async: false,
		timeout: 1000000,
		success: function(msg){ 
            serverType = msg.servType.toLowerCase();
		}
	});
}

/*
Loads a given page within the server type folder
if dirRoot is true the given page will be loaded from the directory root
*/
function loadPage(page, dirRoot)
{
	if (dirRoot === undefined) {
		dirRoot = false;
    }

	var fullPath;
	if (dirRoot)
		fullPath = page;
	else
		fullPath = serverType+"/"+page;
	
	$("#content").load(fullPath, function(responseTxt, statusTxt, xhr){
		//if (statusTxt == "error")
			//alert("Error: unable to load "+ fullPath);
	});
}

/*
Loads the server type menu
*/
function loadMenu()
{
	$("#menu").load(serverType+"/menu.html", function(responseTxt, statusTxt, xhr){
		if (statusTxt == "error")
			alert("Error: unable to load "+ serverType+"/"+page);			
	});

}



</script>
<!--	
<script>

function requestLobby2()
{
	var dataString = '{"request":[{"name":"serverInfo"},{"name":"players", "data":{"sort":"DESC"}}]}';
	
		$.ajax({
			type: "post",
			url: "http://localhost:8082/request.json",
			//data: dataString,
			cache: false,
			success: function(data) {
				document.getElementById('msg').innerHTML = data;
			}
		});		
}

function requestLobby()
{
	var dataString = '{"request":[{"name":"serverInfo"},{"name":"players", "data":{"sort":"DESC"}}]}';
	
		$.ajax({
			type: "post",
			url: "http://localhost:8082/request.json",
			data: dataString,
			cache: false,
			success: function(data) {
				document.getElementById('msg').innerHTML = data;
			}
		});		
}

function request()
{
	var dataString = '{"request":["serverInfo", "players"]}';
	
		$.ajax({
			type: "get",
			url: "http://localhost:8082/serverinfo.json",
			//data: dataString,
			cache: false,
			success: function(data) {
				handelResponse(data);
			}
		});		
}	
		
		
function handelResponse(data)		
{
	//console.debug(data);
	var json = data;

	document.getElementById('serverName').innerHTML = '';
	document.getElementById('serverMOTD').innerHTML = '';
	document.getElementById('mapName').innerHTML = json.mapname;
	document.getElementById('gameMode').innerHTML = json.gamemode;
	document.getElementById('matchState').innerHTML = json.MatchState;
	document.getElementById('playerCount').innerHTML = '';
	document.getElementById('maxPlayers').innerHTML = '';
	document.getElementById('spectatorCount').innerHTML = '';
	document.getElementById('maxSpectators').innerHTML = '';
	
	document.getElementById('timeLimit').innerHTML = timeConvert(json.timelimit);
	document.getElementById('timeRemaining').innerHTML = timeConvert(json.timeremaining);
	document.getElementById('goalScore').innerHTML = json.goalscore;
	
	document.getElementById('playerTable').innerHTML = generatePlayerTable(json.Players);
}

function generatePlayerTable(playersJson)
{
	var html = "<h2>Players</h2>";
	
	html += "<table><tr><th>Name</th><th>Score</th><th>Kills</th><th>Deaths</th><th>Kick?</th><th>Ban?</th></tr>";
		
	for (Player in playersJson)
	{
		var PlayerData = playersJson[Player];
		html += "<tr>";
		html += "<td><a alt=\""+ PlayerData.id +"\">" + PlayerData.name + "</a></td>";
		html += "<td>" + PlayerData.score + "</td>";
		html += "<td>" + PlayerData.kills + "</td>";
		html += "<td>" + PlayerData.deaths + "</td>";

		if (PlayerData.bot == 0)
		{
			html += "<td></td>";
			html += "<td></td>";
		}
		else
		{
			html += "<td><a herf=\"#\" onclick=\"actionPlayerKick('"+ (PlayerData.id? PlayerData.id : PlayerData.name) +"')\">Kick</a></td>";
			html += "<td><a herf=\"#\" onclick=\"actionPlayerBan('"+ (PlayerData.id? PlayerData.id : PlayerData.name) +"')\">Ban</a></td>";
		}
		html +="</tr>";
	}
		
	html += "</table>";	
	
	
	return html;
}

function timeConvert(seconds)
{
	var date = new Date(1970,0,1);
    date.setSeconds(seconds);
    return date.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/, "$1");
}


function actionPlayerKick(NameOrUID)
{
	if (NameOrUID)
	{
		var json = '{"action":[{"kick":"'+ NameOrUID +'"}]}';
		sendAction(json);
	}
}

function actionPlayerBan()
{
}

function sendAction(data)
{
	$.ajax({
		type: "post",
		url: "http://localhost:8082/action.json",
		data: data,
		cache: false,
		success: function(data) {
			document.getElementById('msg').innerHTML = data;
		}
	});	
}
//setInterval(request, 2000);
request();
</script>
-->	
	</head>
	
	<body>
		<div id="wrapper">
		
			<main>
				<div id="msg"></div>
					
				<div id="content" class="innertube">
				temp
				</div>
			</main>
			
			<nav id="nav">
				<div class="innertube">
					<h3>Main</h3>
					<ul>
						<li><a href="#">Console</a></li>
						<li><a href="#">Access Policy</a></li>
						<li><a href="#">Logout</a></li>
					</ul>
				</div>					
				<div id="menu" class="innertube">

									
				</div>
			</nav>
			
		</div>
	</body>
</html>